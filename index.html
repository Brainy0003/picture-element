<!DOCTYPE html>
<html>
<head>
<title>The picture element: An HTML extension for responsive images</title>
<meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
<script src='http://www.w3.org/Tools/respec/respec-w3c-common' class='remove' async></script>
<script type="text/javascript" class='remove'>
	var respecConfig = {
		specStatus:           "unofficial",
		shortName:            "respimg",
		noIDLSorting:         true,
		edDraftURI:           "http://picture.responsiveimages.org",

		editors:  [
		{ 
			name: "Marcos Cáceres",
			company: "Responsive Images Community Group",
			companyURL: "http://www.w3.org/community/respimg/"
		},
		{ 
			name: "Mat Marquis",
			company: "Responsive Images Community Group",
			companyURL: "http://www.w3.org/community/respimg/"
		},
		{
			name: "Yoav Weiss",
			company: "Responsive Images Community Group",
			companyURL: "http://www.w3.org/community/respimg/"
		 	
		},
		{
			name: "Adrian Bateman",
			company: "Microsoft Corporation",
			companyURL: "http://www.microsoft.com/"
		}],
		wg:           "Responsive Images Community Group",
		wgURI:        "http://www.w3.org/community/respimg/",
		wgPublicList: "public-respimg",
		wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/40318/status",
		issueBase:   "https://github.com/ResponsiveImagesCG/picture-element/issues",
		noIDLSectionTitle: true
	};
	</script>
<style type="text/css">
.informative {
	background-color: rgb(233, 251, 233);
}
figure {
  display: block;
  border: thin silver solid;
  margin: 0.5em;
  padding: 0.5em;
  text-align: center;	
}
figcaption {
  font-style: italic;
  font-size: smaller;
  text-indent: 0;
}
figcaption:before {
  font-weight: bold;
  counter-increment: figcaption;     
  content: "Figure " counter(figcaption) ". "
}
ol > li {
	margin-bottom: 1em;
}
#conformance dd {
	margin-bottom: 1em;
}
pre {
	tab-size: 3; /* Reduce indentation. */
}
.informative-subhed {
	font-size: 120%;
}
a {
	color: blue
}
a:not([href]) {
	color: red
}
#open-issues-xhr {
	font-size: .9em;
}
#open-issues-xhr li {
	padding: .25em 0;
}
#open-issues-xhr .meta {
	display: block;
	font: normal .8em/1 sans-serif;
	padding: .35em 0 0 0;
}
#open-issues-xhr .meta b {
	font-weight: normal;
}
#open-issues-xhr .meta span {
	display: block;
	float: left;
	width: 5.5em;
}
</style>
</head>
<body>

<section id='abstract'>
  <p>The <code>picture</code> element is an image whose source content is determined    by one or more CSS media queries.</p>
</section>

<section id="introduction" class="informative">
  <h1>Introduction</h1>
  <p>With the increasing commodification of high-density screens on  mobile devices, and with a trend towards  increasing screen resolutions, web developers have had to created a range of custom solutions to for serving images that best match a user's browsing enviroment. For a list of examples of the range of techniques in use in 2012, see Chris Coyier's article "<a href="http://css-tricks.com/which-responsive-images-solution-should-you-use/">Which responsive images solution should you use?</a>". </p>
  <p>This specification   provides developers with a means to declare multiple sources for an image, and, through <cite>CSS Media Queries</cite> ([[!CSS3-MEDIAQUERIES]]), it gives developers control as to when those images are to be presented to a user. This is achieved by introducing a new <code>picture</code> element to [[!HTML5]] that makes use of the  <code> source</code> element. The <code>picture</code> element remains backwards compatible with legacy user agents by degrading gracefully through <a>fallback content</a> (i.e., through the <code>img</code> element) while also potentially providing better accessibility than the existing <code>img</code> element. </p>
  <p>By relying on [[!CSS3-MEDIAQUERIES]], a user agent can <em>respond</em> to changes in the browsing environment by selecting the image source that most closely matches the browsing environment - thus embodying a technique known as <a href="http://en.wikipedia.org/wiki/Responsive_web_design">responsive web design</a> directly in the HTML markup. <a href="http://www.w3.org/TR/css3-mediaqueries/#media1">Media features</a> that a user agent can potentially respond to include, but are not limited to,  pixel widths and heights, and pixel densities, as well as environmental lighting conditions, changes in orientation, and  changes in   media type such as going from screen to print. </p>
  <p>This specification also defines the <code>HTMLPictureElement</code> programming interface, which affords developers a set of attributes and methods for interacting with  <code>picture</code> elements through ECMAScript.</p>
  
  
  <section>
    <h2>Example of usage</h2>
    <p>This first sample shows how to combine the <code>picture</code> element with the source element, while also providing fallback content for legacy user agents through the <code>img</code> element. </p>
    <pre class="example">&lt;picture width=&quot;500&quot; height=&quot;500&quot;&gt;
   &lt;source media="(min-width: 45em)" src="large.jpg"&gt;
 	&lt;source media="(min-width: 18em)" src="med.jpg"&gt;
 	&lt;source src="small.jpg"&gt;
  	&lt;img src="small.jpg" alt=""&gt;
   &lt;p&gt;Accessible text&lt;/p&gt;
&lt;/picture&gt;
</pre>
  
  <div class="issue">
    <p>The following example assumes we can get <a href="http://dev.w3.org/html5/srcset/">the <code>srcset</code> attribute</a> supported on HTML's <code>source</code> element. See <a href="https://github.com/Wilto/draft-prop/issues/64">issue 64</a>.</p>
  </div>
  
  <p>This second example shows how the <code>picture</code> element can be used with <a href="http://dev.w3.org/html5/srcset/">the <code>srcset</code> attribute</a> to provide a range of sources suitable for a given media query:</p>
  <pre class="example">&lt;picture width=&quot;500&quot; height=&quot;500&quot;&gt;
   &lt;source media="(min-width: 45em)" srcset="large-1.jpg 1x, large-2.jpg 2x"&gt;
 	&lt;source media="(min-width: 18em)" srcset="med-1.jpg 1x, med-2.jpg 2x"&gt;
 	&lt;source srcset="small-1.jpg 1x, small-2.jpg 2x"&gt;
  	&lt;img src="small-1.jpg" alt=""&gt;
   &lt;p&gt;Accessible text&lt;/p&gt;
&lt;/picture&gt;</pre>
</section>

 

  <section>
    <h2>Differences from <code>img</code> element</h2>
    <p>Unlike the <code>img</code> element and its current <a href="http://dev.w3.org/html5/srcset/"><code>srcset</code> attribute</a>,  the <code>picture</code> element is intended to allow an author to reference many different image sources and associate those image sources with  a CSS media query [[!CSS3-MEDIAQUERIES]]. The <code>srcset</code> attribute of the <code>img</code> element only allows matching on display dimensions and pixel densities, and the user agent is not required to respect the author's declared desires. </p>
    <p>The browser dynamically updates the displayed image based on the browsing environment. This means that the developer determines the most suitable image for the browsing environment. Or the most suitable image source may be a different version of an image that has been modified by the author to be suitable for a particular use (see: <a>art direction</a> use case). </p>
  </section>
</section>

<section id="sotd">
  <div class="note">
    <p>This specification is under active development and changing frequently. Please see the list of <a>open issues</a>.</p>
  </div>
  <p>This document was proposed by the <a href="http://www.w3.org/community/respimg/">Responsive Images Community Group</a> as a solution to <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=18384">bug 18384</a>.</p>
</section>
<section id="conformance">
  <p>This specification has the same <a href="http://dev.w3.org/html5/spec/single-page.html#conformance-requirements">conformance requirements</a> and applies to the same <a href="http://dev.w3.org/html5/spec/single-page.html#conformance-classes">conformance classes</a> as [[!HTML5]].
  <p>Implementations that use ECMAScript to expose the APIs defined in this specification MUST implement them in a manner consistent with the ECMAScript Bindings defined in the [[!WEBIDL]] specification.</p>
</section>
<section id="definitions">
  <h1>Definitions</h1>
  <p>The following terms are used throughout this specification so they are gathered here for the readers convenience. The following list of terms is not exhaustive; other terms are defined throughout this specification.</p>
  <p>The follow terms are defined by the<cite> </cite>[[!HTML5]] specification: <dfn><a href="http://www.w3.org/TR/html5/the-img-element.html#the-img-element"><code>img</code> element</a></dfn>, <dfn><a href="http://www.w3.org/TR/html5/the-source-element.html#the-source-element"><code>source</code> element</a></dfn>, <dfn><a href="http://www.w3.org/TR/html5/content-models.html#fallback-content">fallback content</a></dfn>, and <dfn><a href="http://www.w3.org/TR/html5/common-microsyntaxes.html#valid-media-query">valid media query</a></dfn>. </p>
</section>
<section>
  <h1>The <code>picture</code> element</h1>
  <dl>
    <dt><a href="http://dev.w3.org/html5/spec/single-page.html#element-dfn-categories" title="element-dfn-categories">Categories</a>:</dt>
    <dd><a href="http://dev.w3.org/html5/spec/single-page.html#flow-content-1">Flow content</a>.</dd>
    <dd><a href="http://dev.w3.org/html5/spec/single-page.html#phrasing-content-1">Phrasing content</a>.</dd>
    <dd><a href="http://dev.w3.org/html5/spec/single-page.html#embedded-content-2">Embedded content</a>.</dd>
    <dd><a href="http://dev.w3.org/html5/spec/single-page.html#palpable-content-0">Palpable content</a>.</dd>
    <dt><a href="http://dev.w3.org/html5/spec/single-page.html#element-dfn-contexts" title="element-dfn-contexts">Contexts in which this element can be used</a>:</dt>
    <dd>Where <a href="http://dev.w3.org/html5/spec/single-page.html#embedded-content-2">embedded content</a> is expected.</dd>
    <dt><a href="http://dev.w3.org/html5/spec/single-page.html#element-dfn-content-model" title="element-dfn-content-model">Content model</a>:</dt>
    <dd>If zero descendents, then <a href="http://dev.w3.org/html5/spec/content-models.html#transparent">transparent</a>. </dd>
    <dd>One or more <code>source</code> elements.</dd>
    <dd>Zero or one <code>img</code> element, serving as <a>fallback content</a>.</dd>
    <dt><a href="http://dev.w3.org/html5/spec/single-page.html#element-dfn-attributes" title="element-dfn-attributes">Content attributes</a>:</dt>
    <dd><a href="http://dev.w3.org/html5/spec/single-page.html#global-attributes">Global attributes</a></dd>
    <dd><code>width</code></dd>
    <dd><code>height</code></dd>
    <dt><a href="http://dev.w3.org/html5/spec/single-page.html#element-dfn-dom" title="element-dfn-dom">DOM interface</a>:</dt>
    <dd>
      <pre>[NamedConstructor=Picture,
 NamedConstructor=Picture(unsigned long width),
 NamedConstructor=Picture(unsigned long width, unsigned long height)]
HTMLPictureElement : HTMLImageElement{
   readonly attribute DOMString media; 
}</pre>
    </dd>
  </dl>
  <p>The <code><dfn>picture</dfn></code> element used for displaying an image that can come from a range of sources (see <code>srcset</code> attribute). Which image the user agent displays depends on the <a>algorithm for deriving the source image</a>. </p>
  <p>On getting the <code>media</code> IDL attribute, the user agent MUST return the media query that matches the current environment. </p>
  <p>It is RECOMMENDED that for cases where a single image source is available, and where no responsive adoption is needed, authors  use the <code>img</code> element. </p>
</section>
<p>The <a>chosen image</a> is the embedded content. </p>
<p>For user agents that don't support the <code>picture</code> element, an author can provide an <code>img</code> element as <a>fallback content</a>. User agents SHOULD NOT show this content to the user: it is intended for legacy user agents that do not support <code>picture</code>, so that a legacy <code>img</code> element can be shown instead.</p>
<p>Authoring requirement: as with the <code>img</code> element, documents  must not use the <code>picture</code> element as a layout tool. In particular, picture elements should not be used to display transparent images, as they rarely convey meaning and rarely add anything useful to the document. </p>
<section>
  <p>When used with the <code>picture</code> element, a <a>document</a> SHOULD only contain <code>source</code> elements need to represent the same subject matter, but cropping and zooming can differ.</p>
  <div class="issue">
    <p>It should be codified that this is not a mechanism by which to swap disparate images depending on screen size. See bug <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=18384#c7">18384</a>.</p>
  </div>
</section>
</section>
</section>
<section id="algorithms">
  <h1>Algorithm for deriving the source image</h1>
  <p>The <dfn>algorithm for deriving the source image</dfn> as follows. The result is the image source to be used by the <code>picture</code> element, which reflects  the <code>picture</code> element's <a><code>src</code> IDL attribute</a>: </p>
  <div class="note">
    <p>What we want to do is have the <code>picture</code> behave exactly the same as an <code>img</code> element, but with the only difference being that it is <code>source</code> elements is used to determine the value of the <code>src</code> IDL attribute (and hence what image content is displayed). How that is determined is through  using the <code>media</code> attribute attribute of the <code>source</code> element. </p>
    <p>To avoid complexity, the <code>type</code> attribute is all child <code>source</code> elements is ignored in this context. </p>
    <p>So, to derive the <dfn>source image</dfn>: we gather all the media queries from the <code>source</code> elements' <code>media</code> attributes into a &quot;stylesheet&quot;, in document order. Any missing <code>media</code> attributes are just assumed to mean &quot;all&quot;. Any media attributes that are not valid media queries are ignored. So, given the following: </p>
    <pre>&lt;picture id=&quot;pictureElement&quot;&gt;
<span class="example">   &lt;source media="(min-width: 45em)" srcset="large-1.jpg 1x, large-2.jpg 2x"&gt;
 	&lt;source media="(min-width: 18em)" srcset="med-1.jpg 1x, med-2.jpg 2x"&gt;
   
   &lt;!-- assume media all --&gt; 
 	&lt;source srcset="small-1.jpg 1x, small-2.jpg 2x"&gt;</span>
   
   &lt;!-- the following are ignored --&gt;
<span class="example">   &lt;source media=" is the message " srcset=&quot;&quot;&gt;
      </span>
&lt;/picture&gt;</pre>
    <p>Becomes the rough CSS equivalent of (a virtual stylesheet for the document?):</p>
    <pre>

//assume #pictureElement is magically scoped to the corresponding element. 
@media all{
   #pictureElement{
      background-image: image-set(<span class="example">small-1.jpg 1x, small-2.jpg 2x</span>);
   }
}

@media<span class="example"> all and (min-width: 45em)</span>{
   #pictureElement{      
      background-image: image-set(<span class="example">large-1.jpg 1x, large-2.jpg 2x</span>);
   }
}

@media <span class="example">all and </span><span class="example">(min-width: 18em)</span>{
   #pictureElement{      
      background-image: image-set(<span class="example">med-1.jpg 1x, med-2.jpg 2x</span>);
   }
}</pre>
    <p>The API then just works the same as per images. Events are fired in the same way as if the image's src IDL attribute had been set manually by the author. </p>
    <p>The resource fetching behavior of then governed by <cite>CSS Image Values and Replaced Content Module Level 4</cite>.</p>
  </div>
  <p>A user agent MAY  override requests for higher-resolution images based on  user preferences. For example: “always request high-resolution images,” “always request low-resolution images,” and “request high-resolution images as bandwidth permits” based on the bandwidth information available to the browser.</p>
</section>
  
</section>

<!-- appendix -->
<section class='appendix'>
  <h1>Open Issues</h1>
  <p>We are tracking <dfn>open issues</dfn> on Github. <a href="https://github.com/ResponsiveImagesCG/picture-element/issues">Please help close them</a>! </p>
  <div id="open-issues-xhr"></div>
  <h1>Reference implementations</h1>
  <p>We have a list of <a href="https://github.com/Wilto/draft-prop/wiki/Current-users,-polyfills,-prototypes,-and-implementations">current users, polyfills, prototypes, and implementations</a> on Github. </p>
  <h1>Acknowledgements</h1>

<p id="participants">A list of <a href="http://www.w3.org/community/respimg/participants">participants</a> is avialble at the W3C Community Group Website.</p>
</section>
<script src="https://raw.github.com/ResponsiveImagesCG/meta/master/scripts/show_issues.js"></script>
<script src="https://api.github.com/repos/ResponsiveImagesCG/picture-element/issues?state=open&amp;callback=processResponse"></script>
<script src="https://raw.github.com/ResponsiveImagesCG/meta/master/scripts/ga.js"></script>
<script>
//This script dynamically loads the participants of the CG and shows them in the spec. 
window.addEventListener("DOMContentLoaded", function requestParticipants(){
  var xhr = new XMLHttpRequest(),
  	  output = document.querySelector("#participants"), 
      participantsURL = output.querySelector("a").getAttribute("href"),
	  tempElem = document.createElement("temp"), 
	  participants;
  xhr.open("GET", participantsURL,true);
  xhr.onreadystatechange= processParticipants; 
  xhr.send(null); 
  
  function processParticipants(){
	 if (xhr.readyState==4) {
		//participants are in a table on the other website
		tempElem.innerHTML = xhr.responseText;
		participants = tempElem.querySelectorAll("td > h3");
		if(participants.length > 0){
 	  		showParticipants(participants)
		}
 	}
  } 
  
  function showParticipants(){
	var names  = [],
		prefix = "Participants of the Responsive Images Community Group are: ";
	if(participants.length){
		for(var i = 0; i < participants.length; i++){
			names.push(participants.item(i).textContent);
		}
		output.innerHTML = prefix + names.join(", ") + "."; 
	}
  }
 }, false); 
</script>
